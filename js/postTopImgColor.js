function rgbToHslValue(e,t,o,r=0){r>0&&(e=Math.round(e+(255-e)*r),t=Math.round(t+(255-t)*r),o=Math.round(o+(255-o)*r)),e/=255,t/=255,o/=255;let s,l,n=Math.max(e,t,o),a=Math.min(e,t,o),c=(n+a)/2;if(n===a)s=l=0;else{let r=n-a;switch(l=c>.5?r/(2-n-a):r/(n+a),n){case e:s=(t-o)/r+(t<o?6:0);break;case t:s=(o-e)/r+2;break;case o:s=(e-t)/r+4}s/=6}return`${Math.round(360*s)} ${Math.round(100*l)}% ${Math.round(100*c)}%`}function setDefaultTheme(){const e=document.documentElement,t="3 81% 72%";e.style.setProperty("--glmp-color",t),e.style.setProperty("--glimp-post-topbg","transparent"),e.style.setProperty("--glmp-postFooterbg","0 33% 96%"),e.style.setProperty("--heo-main-op",`hsla(${t}, 0.5)`),e.style.setProperty("--heo-main-op-deep",`hsla(${t}, 0.2)`)}function topcolor(){const e=document.getElementById("body-wrap");if(e)if(e.classList.contains("post")){const e=document.getElementById("post-cover");if(!e)return void setDefaultTheme();e.getAttribute("src")&&(e.crossOrigin="Anonymous");const t=()=>{try{const t=new ColorThief,[o,r,s]=t.getColor(e),l=rgbToHslValue(o,r,s),n=rgbToHslValue(o,r,s,.9),a=document.documentElement;a.style.setProperty("--glmp-color",l),a.style.setProperty("--glmp-postFooterbg",n),a.style.setProperty("--glimp-post-topbg",`hsl(${l})`)}catch(e){console.error("ColorThief 提取失败 (CORS 或 图片未加载):",e),setDefaultTheme()}};e.complete&&0!==e.naturalWidth?t():e.addEventListener("load",t,{once:!0})}else setDefaultTheme()}topcolor();