let body,mainContainer,scene,renderer,camera,windowWidth,windowHeight,windowHalfWidth,windowHalfHeight,graphicCanvas,gctx,cameraLookAt=new THREE.Vector3(0,0,0),cameraTarget=new THREE.Vector3(0,0,800),mouseX=0,mouseY=0,colors=["#F7A541","#F45D4C","#FA2E59","#4783c3","#9c6cb7"],canvasWidth=240,canvasHeight=240,graphicPixels=[],particles=[],graphicOffsetX=canvasWidth/2,graphicOffsetY=canvasHeight/4;const initStage=()=>{mainContainer=document.querySelector("#flow"),setWindowSize(),window.addEventListener("resize",onWindowResize,!1),window.addEventListener("mousemove",onMouseMove,!1)},initScene=()=>{scene=new THREE.Scene,renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(windowWidth,windowHeight),mainContainer.appendChild(renderer.domElement),scene.background=new THREE.Color(16777215)},initCamera=()=>{const e=windowWidth/windowHeight;camera=new THREE.PerspectiveCamera(75,e,1,3e3),camera.position.z=800},initCanvas=()=>{graphicCanvas=document.createElement("canvas"),graphicCanvas.width=canvasWidth,graphicCanvas.height=canvasHeight,gctx=graphicCanvas.getContext("2d"),drawDefaultGraphic()},drawDefaultGraphic=()=>{gctx.fillStyle="#FFFFFF",gctx.fillRect(0,0,canvasWidth,canvasHeight),gctx.fillStyle="#000000",gctx.font="bold 100px Arial, sans-serif",gctx.textAlign="center",gctx.textBaseline="middle",gctx.fillText("Hi",canvasWidth/2,canvasHeight/2)},initLights=()=>{const e=new THREE.DirectionalLight(16777215,2);e.position.set(20,0,10),scene.add(e);const t=new THREE.DirectionalLight(16777215,1.5);t.position.set(-20,0,20),scene.add(t);const i=new THREE.DirectionalLight(16777215,1);i.position.set(0,0,-20),scene.add(i)};function Particle(){this.vx=.05*Math.random(),this.vy=.05*Math.random()}function updateParticles(){for(var e=0,t=particles.length;e<t;e++)particles[e].updateRotation(),particles[e].updatePosition()}Particle.prototype.init=function(e){const t=new THREE.Object3D,i=new THREE.SphereGeometry(2,4,4),a=new THREE.MeshBasicMaterial({color:colors[e%colors.length]}),n=new THREE.Mesh(i,a);n.geometry.dynamic=!0;const o=getGraphicPos(graphicPixels[e]);t.targetPosition=new THREE.Vector3(o.x,o.y,o.z),t.position.set(.5*windowWidth,.5*windowHeight,-10*Math.random()+20),randomPos(t.position);if(n.geometry.attributes.position);else for(var r=0;r<n.geometry.vertices.length;r++)n.geometry.vertices[r].x+=4*Math.random()-2,n.geometry.vertices[r].y+=4*Math.random()-2,n.geometry.vertices[r].z+=4*Math.random()-2;t.add(n),this.particle=t},Particle.prototype.updateRotation=function(){this.particle.rotation.x+=this.vx,this.particle.rotation.y+=this.vy},Particle.prototype.updatePosition=function(){this.particle.position.lerp(this.particle.targetPosition,.1)};const getGraphicPos=e=>({x:3*(e.x-graphicOffsetX-4*Math.random()-2),y:3*(canvasHeight-e.y-canvasHeight/2-4*Math.random()-2),z:-20*Math.random()+40}),setParticles=()=>{for(let e=0;e<graphicPixels.length;e++)if(particles[e]){const t=getGraphicPos(graphicPixels[e]);particles[e].particle.targetPosition.x=t.x,particles[e].particle.targetPosition.y=t.y,particles[e].particle.targetPosition.z=t.z}else{const t=new Particle;t.init(e),scene.add(t.particle),particles[e]=t}for(let e=graphicPixels.length;e<particles.length;e++)randomPos(particles[e].particle.targetPosition,!0);console.log("Total Particles: "+particles.length)};function randomPos(e,t=!1){const i=windowWidth+(t?2*windowWidth:-2*windowWidth)*Math.random(),a=Math.random()*Math.PI*2;e.x=0+i*Math.cos(a),e.y=0+i*Math.sin(a),e.z=Math.random()*windowWidth}const updateGraphic=()=>{const e=gctx.getImageData(0,0,canvasWidth,canvasHeight).data;graphicPixels=[];for(let t=e.length-4;t>=0;t-=4)if(0==e[t]&&e[t+3]>0){const e=t/4,i=e%canvasWidth,a=Math.floor(e/canvasWidth);i%2==0&&a%2==0&&graphicPixels.push({x:i,y:a})}setParticles()},initBgObjects=()=>{for(let e=0;e<40;e++)createBgObject(e)},createBgObject=e=>{const t=new THREE.SphereGeometry(10,6,6),i=new THREE.MeshBasicMaterial({color:14540253}),a=new THREE.Mesh(t,i);scene.add(a);const n=Math.random()*windowWidth*2-windowWidth,o=Math.random()*windowHeight*2-windowHeight,r=-2e3*Math.random()-200;a.position.set(n,o,r)},onMouseMove=e=>{mouseX=e.clientX-windowHalfWidth,mouseY=e.clientY-windowHalfHeight,cameraTarget.x=-1*mouseX/2,cameraTarget.y=mouseY/2},onWindowResize=()=>{setWindowSize(),camera.aspect=windowWidth/windowHeight,camera.updateProjectionMatrix(),renderer.setSize(windowWidth,windowHeight)},setWindowSize=()=>{windowWidth=window.innerWidth,windowHeight=window.innerHeight,windowHalfWidth=windowWidth/2,windowHalfHeight=windowHeight/2},animate=()=>{requestAnimationFrame(animate),updateParticles(),camera.position.lerp(cameraTarget,.2),camera.lookAt(cameraLookAt),render()},render=()=>{renderer.render(scene,camera)};initStage(),initScene(),initCanvas(),initCamera(),initBgObjects(),initLights(),updateGraphic(),animate();